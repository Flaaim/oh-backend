services:
    nginx:
      build:
          context: docker/nginx
      ports:
          - "80:80"
      volumes:
          - ./:/app
      depends_on:
          - php-fpm
    php-fpm:
      build:
          context: docker/php-fpm
      volumes:
          - ./:/app
      environment:
          APP_DEBUG: 1
          SITE_URL: localhost
          SITE_NAME: Docker
          APP_ENV: dev
          DB_HOST: mysql
          DB_USER: app
          DB_PASSWORD: secret
          DB_NAME: app
          MAILER_HOST: mailer
          MAILER_PORT: 1025
          MAILER_USER: app
          MAILER_PASSWORD: secret
          MAILER_ENCRYPTION: tcp
          MAILER_FROM_EMAIL: admin@site.ru
          MAILER_FROM_NAME: admin
    php-cli:
      build:
          context: docker/php-cli
      volumes:
          - ./:/app
      environment:
          APP_DEBUG: 1
          SITE_URL: localhost
          SITE_NAME: Docker
          APP_ENV: dev
          DB_HOST: mysql
          DB_USER: app
          DB_PASSWORD: secret
          DB_NAME: app
          MAILER_HOST: mailer
          MAILER_PORT: 1025
          MAILER_USER: app
          MAILER_PASSWORD: secret
          MAILER_ENCRYPTION: tcp
          MAILER_FROM_EMAIL: admin@site.ru
          MAILER_FROM_NAME: admin
    mysql:
      image:  mysql:8.0
      restart: always
      environment:
        MYSQL_ROOT_PASSWORD: rootpassword
        MYSQL_USER: app
        MYSQL_PASSWORD: secret
        MYSQL_DATABASE: app
      volumes:
        - mysql:/var/lib/mysql
      ports:
        - "33061:3306"
      command: --default-authentication-plugin=mysql_native_password

    mailer:
      image: mailhog/mailhog
      ports:
        - "8082:8025"

volumes:
  mysql: